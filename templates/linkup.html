<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Link</title>
    <link rel = "icon" href="images/linklogo.png" type = "image/x-icon">
    <link rel="stylesheet" href="../stylesheets/linkup.css">
    <script type="text/javascript" src="../scripts/ticketmaster-2.0.4.min.js"></script>
    <script type="text/javascript">
      let startDateTime = '{{hangout_date}}' + 'T00:00:00Z'
      let endDateTime = '{{hangout_date}}' + 'T11:59:59Z'
      // TODO: fix zipcode/location!!
      ticketmaster('{{api_key}}').discovery.v2.event.all({city:['London'], startDateTime: startDateTime, endDateTime: endDateTime})
      .then((result) => {
        console.log(result);
        for (let item of result.items){
          let eventElement = document.createElement('div');
          eventElement.classList.add('eventElement'); //to style in CSS later
          let title = document.createElement('a');
          title.textContent = item.name;
          title.href = item.url;
          title.target = '_blank'
          eventElement.appendChild(title);
          let image = document.createElement('img');
          image.src = item.images[0].url; // later handle the case when there are no images
          eventElement.appendChild(image);
          let date = new Date(item.dates.start.dateTime)
          // console.log(date);
          let parsed_date = date.toLocaleDateString("en-US", {
            weekday:'long',
            year:'numeric',
            month:'long',
            day:'numeric',
            hour:'numeric',
            minute:'numeric',
            timeZoneName:'short',
          });
          // let parsed_date = parseDate(item.dates.start.dateTime);
          let datetime = document.createTextNode(parsed_date);
          eventElement.appendChild(datetime);
          document.body.appendChild(eventElement);
        }
      });
    </script>
  </head>
  <body>
    <header class="w3-container w3-xlarge">
      <a href="/"><img src="images/linklogo.png" alt="CSGO Howl" style="width:100px;height:100px;float:left";></a>
      <p class="w3-right">
        <div align="right">
        <a href="/login" class="button" href="{{logout_link}}">Logout</a>
      </div>
      </p>
    </header>
    <br>
    <h3>Friends who are free on {{hangout_date}}: </h3>
    {%if friends_free|length == 0%}
    You have no friends or none of your friends are free.
    <br>
    <br>
    {%else %}
    <br>
    {% for friend in friends_free %}
    <br>
    <br>
    <br>
      {{friend}}
      <br>
    {% endfor %}
    <br>
    {%endif%}
  </body>
</html>
